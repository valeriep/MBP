<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="width=device-width, user-scalable=no" />
<meta name="author" content="ch4mp@c4-soft.com" />
<title>MyBestPistes unit testing</title>

<!-- Codova (Phonegap) -->
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>

<!-- The well known js library (along with it's mobile specialization) -->
<link rel="stylesheet" href="../www/lib/jquery.mobile-1.3.2/jquery.mobile-1.3.2.css" />
<script src="../www/lib/jquery-1.10.2/jquery-1.10.2.js"></script>
<script src="../www/lib/jquery.mobile-1.3.2/jquery.mobile-1.3.2.js"></script>

<!-- Template engine -->
<script src="../www/lib/dot/doT.js"></script>

<script id="dot-mark-snippet" type="text/x-dot-template">
{{##def.mark:val:
<img class="mark-star-0" src="{{? !val || val <= 0 }}icon/star-off.png{{?? val >= 1 }}icon/star-on.png{{?? true }}icon/star-half.png{{?}}" />
<img class="mark-star-1" src="{{? !val || val <= 1 }}icon/star-off.png{{?? val >= 2 }}icon/star-on.png{{?? true }}icon/star-half.png{{?}}" />
<img class="mark-star-2" src="{{? !val || val <= 2 }}icon/star-off.png{{?? val >= 3 }}icon/star-on.png{{?? true }}icon/star-half.png{{?}}" />
<img class="mark-star-3" src="{{? !val || val <= 3 }}icon/star-off.png{{?? val >= 4 }}icon/star-on.png{{?? true }}icon/star-half.png{{?}}" />
<img class="mark-star-4" src="{{? !val || val <= 4 }}icon/star-off.png{{?? val >= 5 }}icon/star-on.png{{?? true }}icon/star-half.png{{?}}" />
#}}</script>

<script id="dot-auth" type="text/x-dot-template">
<form id="login-form">
    <div data-role="fieldcontain" class="ui-hide-label">
        <label for="username">Username:</label>
        <input type="text" name="username" id="username"{{? it && it.login}} value="{{=it.login}}"{{?}} placeholder="Username" >
    </div>
    <div data-role="fieldcontain" class="ui-hide-label">
        <label for="password">Password:</label>
        <input type="password" name="password" id="password" value="" placeholder="Password" >
    </div>
    <input data-theme="a" type="submit" value="login">
</form></script>

<script id="dot-settings" type="text/x-dot-template">
<p>Hello, {{=it.user.login}}!</p>
<p>You are {{? (it.device.isOnline)() }}{{?? true}}not {{?}}connected</p>
<div class="position"></div>
<a href="#" data-role="button" data-transition="slidefade" class="logout">logout</a></script>

<script id="dot-position" type="text/x-dot-template">
<p>Last known position is: {{=(JSON.stringify)(it)}}</p></script>

<script id="dot-pistes-brief" type="text/x-dot-template">
<ul data-role="listview" data-filter="true">
{{~ it :piste }}
    {{ var avg = (piste.averageMarks.getAverage)(), resort = (piste.getResort)(); }}
    <li>
        <a class="piste-brief" href="#" data-piste-id="{{=piste.id}}" >
            <img src="{{? piste.picture}}{{=piste.picture}}{{??}}piste_default.jpg{{?}}"></img>
            <h2>{{=piste.name}} / {{=resort.name}} / {{=resort.area}} / {{=resort.country}}</h2>
            <p class="average-mark"><img src="icon/{{=piste.color}}-18.png" ></img> {{#def.mark:avg}}</p>
        </a>
    </li>
{{~}}
</ul></script>

<script id="dot-piste-detail" type="text/x-dot-template">
<div id="piste-detail">
    <div class="info"></div>
    <div class="images"></div>
    <div class="marks"></div>
    <span class="add-marks"></span>
    <span class="add-comment"></span>
    <span class="picture-popup"></span>
    <div class="comments"></div>
</div></script>

<script id="dot-piste-info" type="text/x-dot-template">
{{ var resort = (it.getResort)(); }}
<h2><img src="icon/{{=it.color}}-18.png" > {{=it.name}}</h2>
<div><span class="label">{{=i18n('pisteInfo', 'country')}}</span>{{=resort.country}}</div>
<div><span class="label">{{=i18n('pisteInfo', 'area')}}</span>{{=resort.area}}</div>
<div><span class="label">{{=i18n('pisteInfo', 'name')}}</span>{{=resort.name}}</div>
<div>{{=it.description}}</div></script>

<script id="dot-picture-gallery" type="text/x-dot-template">
<img src="{{? it.picture}}{{=it.picture}}{{??}}piste_default.jpg{{?}}" width="150"></img></script>

<script id="dot-piste-marks" type="text/x-dot-template">
<div class="mark">{{=i18n('pisteMarks', 'snow')}}{{#def.mark:it.averageMarks.snow}}</div>
<div class="mark">{{=i18n('pisteMarks', 'sun')}}{{#def.mark:it.averageMarks.sun}}</div>
<div class="mark">{{=i18n('pisteMarks', 'verticalDrop')}}{{#def.mark:it.averageMarks.verticalDrop}}</div>
<div class="mark">{{=i18n('pisteMarks', 'length')}}{{#def.mark:it.averageMarks.length}}</div>
<div class="mark">{{=i18n('pisteMarks', 'view')}}{{#def.mark:it.averageMarks.view}}</div></script>

<script id="dot-piste-comments" type="text/x-dot-template">
<ul data-role="listview" data-inset="true">
{{~ (it.getCommentsIds)() :commentId}}
    {{ var comment = (it.getComment)(commentId); }}
    <li>
        <div class="comment-text">{{=comment.text}}</div>
    </li>
{{~}}
</ul></script>

<script id="dot-piste-add-marks" type="text/x-dot-template">
<a href="#marks-popup" data-rel="popup" data-role="button" data-inline="true" data-position-to="window"{{? !it.user || !(it.user.isAuthenticated)()}} class="ui-disabled"{{?}}>{{=i18n('pisteMarks', 'markButton')}}</a>
<div data-role="popup" id="marks-popup" class="ui-content">
    <form id="marks-form">
        <label for="snow">{{=i18n('pisteMarks', 'snow')}}</label>
        <input type="range" name="snow" id="snow" min="1" max="5" data-highlight="true" value="{{=it.averageMarks.snow}}">
        <label for="sun">{{=i18n('pisteMarks', 'sun')}}</label>
        <input type="range" name="sun" id="sun" min="1" max="5" data-highlight="true" value="{{=it.averageMarks.sun}}">
        <label for="vertical-drop">{{=i18n('pisteMarks', 'verticalDrop')}}</label>
        <input type="range" name="vertical-drop" id="vertical-drop" min="1" max="5" data-highlight="true" value="{{=it.averageMarks.verticalDrop}}">
        <label for="length">{{=i18n('pisteMarks', 'length')}}</label>
        <input type="range" name="length" id="length" min="1" max="5" data-highlight="true" value="{{=it.averageMarks.length}}">
        <label for="view">{{=i18n('pisteMarks', 'view')}}</label>
        <input type="range" name="view" id="view" min="1" max="5" data-highlight="true" value="{{=it.averageMarks.view}}">
        <input data-theme="a" type="submit" class="save-piste-marks" value="Save">
    </form>
</div></script>

<script id="dot-piste-add-comment" type="text/x-dot-template">
<a href="#comment-popup" data-rel="popup" data-role="button" data-inline="true" data-position-to="window"{{? !it.user || !(it.user.isAuthenticated)()}} class="ui-disabled"{{?}}>{{=i18n('commentButton', 'comment')}}</a>
<div data-role="popup" id="comment-popup" class="ui-content">
    <form id="comment-form">
        <input type="text" name="new-comment" id="new-comment-text">
        <input data-theme="a" type="submit" class="save-piste-comment" value="{{=i18n('commentButton', 'save')}">
    </form>
</div></script>

<script id="dot-search-pistes" type="text/x-dot-template">
<form id="search-pistes-form">
    <fieldset data-role="fieldcontain" class="country-select"></fieldset>
    <fieldset data-role="fieldcontain" class="area-select"></fieldset>
    <fieldset data-role="fieldcontain" class="resort-select"></fieldset>
    <fieldset data-role="fieldcontain" class="color-select"></fieldset>
    <fieldset data-role="fieldcontain">
        <label for="name">{{=i18n('searchPistes', 'name')}}</label>
        <input type="text" id="name" name="name"{{? it.name}} value="{{=it.name}}"{{?}}>
    </fieldset>
    <input data-theme="a" type="submit" class="search-pistes" value="{{=i18n('searchPiste', 'go')}}">
</form></script>

<script id="dot-new-piste" type="text/x-dot-template">
<form id="new-piste-form">
    <fieldset data-role="fieldcontain" class="country-select"></fieldset>
    <fieldset data-role="fieldcontain" class="area-select"></fieldset>
    <fieldset data-role="fieldcontain" class="resort-select"></fieldset>
    <fieldset data-role="fieldcontain">
        <label for="name">{{=i18n('newPiste', 'name')}} *</label>
        <input type="text" id="name" name="name"{{? it.name}} value="{{=it.name}}"{{?}}></fieldset>
    <fieldset data-role="fieldcontain" class="color-select"></fieldset>
    <fieldset data-role="fieldcontain">
        <label for="description">{{=i18n('newPiste', 'description')}}</label>
        <textarea id="description" rows="4"></textarea>
    </fieldset>
    <input data-theme="a" type="submit" class="save-piste" value="{{=i18n('newPiste', 'save')}}" >
</form></script>

<script id="dot-value-select" type="text/x-dot-template">
<label for="{{=it.selectId}}">{{=it.label}}{{? it.mandatory}} *{{?}}</label>
<select id="{{=it.selectId}}" name="{{=it.selectId}}"{{? !it.options.length}} disabled="true"{{?}}>
    <option value=''{{? !it.selected}} selected="true"{{?}}></option>
    {{~ it.options :value}}
        <option value="{{=value}}"{{? it.selected == value}} selected="true"{{?}}>{{=value}}</option>
    {{~}}
</select></script>

<script id="dot-key-value-select" type="text/x-dot-template">
<label for="{{=it.selectId}}">{{=it.label}}{{? it.mandatory}} *{{?}}</label>
<select id="{{=it.selectId}}" name="{{=it.selectId}}"{{? !(Object.keys)(it.options).length}} disabled="true"{{?}}>
    <option value=''{{? !it.selected}} selected="true"{{?}}></option>
    {{~ Object.keys(it.options) :key}}
        <option value="{{=key}}"{{? it.selected == key}} selected="true"{{?}}>{{=it.options[key]}}</option>
    {{~}}
</select></script>

<script id="dot-picture-popup" type="text/x-dot-template">
<a href="#picture-popup" data-rel="popup" data-role="button" data-inline="true" data-position-to="window">{{=i18n('picturePopup', 'addPicture')}}</a>
<img id="picture-popup-result" style="width: 120px;{{? !it}} display: none;{{?}}" src="{{=it}}"></img>
<div data-role="popup" id="picture-popup">
    <div>
        <a href="#" data-role="button" data-inline="true" class="take-picture">{{=i18n('picturePopup', 'camera')}}</a>
    </div>
    <div>
        <a href="#" data-role="button" data-inline="true" class="gallery">{{=i18n('picturePopup', 'gallery')}}</a>
    </div>
</div></script>

<script id="dot-navbar" type="text/x-dot-template">
<div data-role="navbar" data-iconpos="top">
    <ul>
        <li><a href="#" data-theme="a" data-role="button" class="home" data-icon="dynastar">{{=i18n('navbar', 'closest')}}</a></li>
        <li><a href="#" data-theme="a" data-role="button" class="search" data-icon="find-pistes">{{=i18n('navbar', 'search')}}</a></li>
        <li><a href="#" data-theme="a" data-role="button" class="new-piste" data-icon="plus">{{=i18n('navbar', 'newPiste')}}</a></li>
        <li><a href="#" data-theme="a" data-role="button" class="my-pistes" data-icon="star">{{=i18n('navbar', 'mine')}}</a></li>
        <li><a href="#" data-theme="a" data-role="button" class="settings" data-icon="gear">{{=i18n('navbar', 'settings')}}</a></li>
    </ul>
</div></script>

<!-- code under test -->
<script src="../www/js/mbp.js"></script>
<script src="../www/i18n/en.js"></script>
<script src="../www/i18n/fr.js"></script>
<script src="../www/js/workflow/AuthWorkflow.js"></script>
<script src="../www/js/workflow/ClosestPistesWorkflow.js"></script>
<script src="../www/js/workflow/NewPisteWorkflow.js"></script>
<script src="../www/js/workflow/SearchPistesWorkflow.js"></script>
<script src="../www/js/workflow/SettingsWorkflow.js"></script>
<script src="../www/js/workflow/UserPistesWorkflow.js"></script>
<script src="../www/js/domain/Comment.js"></script>
<script src="../www/js/domain/Piste.js"></script>
<script src="../www/js/domain/PisteMarks.js"></script>
<script src="../www/js/domain/Resort.js"></script>
<script src="../www/js/domain/ResortSummaries.js"></script>
<script src="../www/js/domain/ResortSummary.js"></script>
<script src="../www/js/domain/User.js"></script>
<script src="../www/js/form/NewPiste.js"></script>
<script src="../www/js/form/SearchPistesCriteria.js"></script>
<script src="../www/js/persistence/JsonComment.js"></script>
<script src="../www/js/persistence/JsonConverter.js"></script>
<script src="../www/js/persistence/JsonPiste.js"></script>
<script src="../www/js/persistence/JsonResort.js"></script>
<script src="../www/js/persistence/LocalResortRepository.js"></script>
<script src="../www/js/persistence/MyBestPistesRepository.js"></script>
<script src="../www/js/persistence/StubSeolanResortRepository.js"></script>
<script src="../www/js/persistence/UserRepository.js"></script>
<script src="../www/js/service/Device.js"></script>
<script src="../www/js/service/LocalAuthenticationService.js"></script>
<script src="../www/js/service/RemoteAuthenticationService.js"></script>
<script src="../www/js/service/ResortSynchronizationService.js"></script>
<script src="../www/js/service/SeolanService.js"></script>
<script src="../www/js/widget/Widget.js"></script>
<script src="../www/js/widget/AddPisteCommentWidget.js"></script>
<script src="../www/js/widget/AddPisteMarksWidget.js"></script>
<script src="../www/js/widget/AreaSelectionWidget.js"></script>
<script src="../www/js/widget/AuthWidget.js"></script>
<script src="../www/js/widget/ColorSelectionWidget.js"></script>
<script src="../www/js/widget/CountrySelectionWidget.js"></script>
<script src="../www/js/widget/NavbarWidget.js"></script>
<script src="../www/js/widget/NewPisteWidget.js"></script>
<script src="../www/js/widget/PictureGalleryWidget.js"></script>
<script src="../www/js/widget/PicturePopupWidget.js"></script>
<script src="../www/js/widget/PisteCommentsWidget.js"></script>
<script src="../www/js/widget/PisteDetailWidget.js"></script>
<script src="../www/js/widget/PisteInfoWidget.js"></script>
<script src="../www/js/widget/PisteMarksWidget.js"></script>
<script src="../www/js/widget/PistesBriefWidget.js"></script>
<script src="../www/js/widget/PositionWidget.js"></script>
<script src="../www/js/widget/ResortSelectionWidget.js"></script>
<script src="../www/js/widget/SearchPistesWidget.js"></script>
<script src="../www/js/widget/SelectionWidget.js"></script>
<script src="../www/js/widget/SettingsWidget.js"></script>
<script src="../www/js/MyBestPistes.js"></script>

<!-- QUnit stuff -->
<link rel="stylesheet" href="qunit-1.12.0.css">
<script src="qunit-1.12.0.js"></script>

</head>
<body>
    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    <div data-role="content"></div>
    <div id="navbar" data-role="footer" data-position="fixed"></div>
    
    <script src="MyBestPistesTest.js"></script>
    <script src="workflow/AuthWorkflowTest.js"></script>
    <script src="workflow/ClosestPistesWorkflowTest.js"></script>
    <script src="workflow/NewPisteWorkflowTest.js"></script>
    <script src="workflow/SearchPistesWorkflowTest.js"></script>
    <script src="workflow/SettingsWorkflowTest.js"></script>
    <script src="workflow/UserPistesWorkflowTest.js"></script>
    <script src="model/persistence/JsonConverterTest.js"></script>
    <script src="model/persistence/LocalResortRepositoryTest.js"></script>
    <script src="model/persistence/MyBestPistesRepositoryTest.js"></script>
    <script src="model/persistence/StubSeolanResortRepositoryTest.js"></script>
    <script src="model/persistence/UserRepositoryTest.js"></script>
    <script src="model/service/DeviceTest.js"></script>
    <script src="model/service/LocalAuthenticationServiceTest.js"></script>
    <script src="model/service/RemoteAuthenticationServiceTest.js"></script>
    <script src="model/service/ResortSynchronizationServiceTest.js"></script>
    <script src="model/service/SeolanServiceTest.js"></script>
    <script src="model/domain/CommentTest.js"></script>
    <script src="model/domain/PisteTest.js"></script>
    <script src="model/domain/ResortTest.js"></script>
    <script src="model/domain/UserTest.js"></script>
    <script src="model/form/NewPisteTest.js"></script>
    <script src="model/form/SearchPistesCriteriaTest.js"></script>
    <script src="widget/AuthWidgetTest.js"></script>
    <script src="widget/SettingsWidgetTest.js"></script>
    <script src="widget/NewPisteWidgetTest.js"></script>
    <script src="widget/PistesBriefWidgetTest.js"></script>
    <script src="widget/PisteDetailWidgetTest.js"></script>
    <script src="widget/PositionWidgetTest.js"></script>
    <script src="widget/SearchPistesWidgetTest.js"></script>
    <script src="widget/WidgetTest.js"></script>
</body>
</html>